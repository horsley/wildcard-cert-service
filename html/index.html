<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SSL Certificate Service</title>
    <meta name="description" content="ä¸ºæµ‹è¯•ç¯å¢ƒè·å–åŸŸåå’Œ SSL è¯ä¹¦çš„è‡ªåŠ©æœåŠ¡">
    <link rel="stylesheet" href="style.css">
    <script src="config.js"></script>
</head>

<body>
    <div class="container">
        <header>
            <h1>ğŸ” SSL Certificate Service</h1>
            <p class="subtitle">ä¸ºæµ‹è¯•ç¯å¢ƒå¿«é€Ÿè·å–åŸŸåå’Œ SSL è¯ä¹¦</p>
        </header>

        <div class="main-grid">
            <!-- å·¦æ ï¼šè¯ä¹¦ä¸‹è½½ + åŸŸåç”Ÿæˆå™¨ -->
            <div class="column">
                <section class="card">
                    <h2>â¬‡ï¸ è¯ä¹¦ä¸‹è½½</h2>
                    <div class="download-grid">
                        <a href="certs/fullchain.cer" download class="download-btn">
                            <span class="icon">ğŸ“„</span>
                            <span class="text">
                                <strong>fullchain.cer</strong>
                                <small>è¯ä¹¦é“¾ï¼ˆåŒ…å«ä¸­é—´è¯ä¹¦ï¼‰</small>
                            </span>
                        </a>
                        <a href="" download id="key-download" class="download-btn">
                            <span class="icon">ğŸ”‘</span>
                            <span class="text">
                                <strong>ç§é’¥</strong>
                                <small>Private Key (.key)</small>
                            </span>
                        </a>
                    </div>

                    <h3>ğŸ“‹ å¤åˆ¶ PEM å†…å®¹</h3>
                    <div class="pem-section">
                        <div class="pem-group">
                            <div class="pem-header">
                                <span>è¯ä¹¦ (fullchain.cer)</span>
                                <button class="copy-btn" onclick="copyPEM('cert')">å¤åˆ¶</button>
                            </div>
                            <textarea id="cert-pem" readonly placeholder="åŠ è½½ä¸­..."></textarea>
                        </div>
                        <div class="pem-group">
                            <div class="pem-header">
                                <span>ç§é’¥ (Private Key)</span>
                                <button class="copy-btn" onclick="copyPEM('key')">å¤åˆ¶</button>
                            </div>
                            <textarea id="key-pem" readonly placeholder="åŠ è½½ä¸­..."></textarea>
                        </div>
                    </div>
                </section>

                <section class="card">
                    <h2>ğŸ› ï¸ åŸŸåç”Ÿæˆå™¨</h2>
                    <div class="tool-container">
                        <div class="input-row">
                            <div class="input-group">
                                <label for="prefix">å‰ç¼€ï¼ˆå¯é€‰ï¼‰</label>
                                <input type="text" id="prefix" placeholder="ä¾‹å¦‚ï¼šmyapp">
                            </div>
                            <div class="input-group">
                                <label for="ip">IP åœ°å€</label>
                                <input type="text" id="ip" placeholder="ä¾‹å¦‚ï¼š192.168.1.100">
                            </div>
                            <button id="convert-btn" onclick="convertIP()">ç”Ÿæˆ</button>
                        </div>
                        <div class="result" id="result">
                            <span class="result-label">ç”Ÿæˆçš„åŸŸåï¼š</span>
                            <code id="generated-domain">-</code>
                            <button class="copy-btn" onclick="copyDomain()" title="å¤åˆ¶åŸŸå">ğŸ“‹</button>
                        </div>
                    </div>
                </section>
            </div>

            <!-- å³æ ï¼šä½¿ç”¨è¯´æ˜ + è¯ä¹¦ä¿¡æ¯ -->
            <div class="column">
                <section class="card">
                    <h2>ï¿½ åŸŸåä½¿ç”¨è¯´æ˜</h2>
                    <p>æœ¬æœåŠ¡åŸºäº <a href="https://sslip.io" target="_blank">sslip.io</a> æä¾› IP åˆ°åŸŸåçš„è‡ªåŠ¨è§£æã€‚</p>

                    <h3>åŸºæœ¬æ ¼å¼</h3>
                    <p>å°† IP åœ°å€ä¸­çš„ <code>.</code> æ›¿æ¢ä¸º <code>-</code>ï¼Œç„¶åæ‹¼æ¥åŸŸååç¼€ï¼š</p>
                    <div class="example">
                        <code>192.168.1.100</code> â†’ <code
                            class="highlight"><span class="domain-example">192-168-1-100</span></code>
                    </div>

                    <h3>æ·»åŠ å‰ç¼€ï¼ˆDash Prefixï¼‰</h3>
                    <p>å¯ä»¥åœ¨ IP å‰æ·»åŠ è‡ªå®šä¹‰å‰ç¼€ï¼Œæ–¹ä¾¿åŒºåˆ†ä¸åŒç”¨é€”ï¼š</p>
                    <div class="example">
                        <code class="highlight"><span class="domain-example">myapp-192-168-1-100</span></code><br>
                        <code class="highlight"><span class="domain-example">api-server-10-0-0-50</span></code>
                    </div>
                </section>

                <section class="card">
                    <h2>ï¿½ è¯ä¹¦ä¿¡æ¯</h2>
                    <div class="cert-info">
                        <div class="info-row">
                            <span class="label">é€‚ç”¨åŸŸåï¼š</span>
                            <code id="cert-domain">åŠ è½½ä¸­...</code>
                        </div>
                        <div class="info-row">
                            <span class="label">æœ‰æ•ˆæœŸè‡³ï¼š</span>
                            <span id="cert-expiry">åŠ è½½ä¸­...</span>
                        </div>
                        <div class="info-row warning">
                            <span>ğŸ’¡ è¯ä¹¦è¿‡æœŸåå¯å†æ¬¡è®¿é—®æœ¬é¡µé¢ä¸‹è½½æœ€æ–°è¯ä¹¦</span>
                        </div>
                    </div>
                </section>
            </div>
        </div>

        <footer>
            <p>Powered by <a href="https://github.com/acmesh-official/acme.sh" target="_blank">acme.sh</a> & <a
                    href="https://sslip.io" target="_blank">sslip.io</a></p>
        </footer>
    </div>

    <script>
        const CONFIG = window.CONFIG || { domain: 'example.com' };

        // åˆå§‹åŒ–åŸŸåæ˜¾ç¤º
        document.addEventListener('DOMContentLoaded', () => {
            // æ›´æ–°æ‰€æœ‰åŸŸåå ä½ç¬¦
            document.querySelectorAll('.domain-example').forEach(el => {
                el.textContent += '.' + CONFIG.domain;
            });

            // è®¾ç½®ç§é’¥ä¸‹è½½é“¾æ¥
            const keyFilename = `*.${CONFIG.domain}.key`;
            document.getElementById('key-download').href = `certs/${keyFilename}`;
            document.getElementById('key-download').download = keyFilename;

            // åŠ è½½è¯ä¹¦ä¿¡æ¯
            loadCertInfo();
            // åŠ è½½ PEM å†…å®¹
            loadPEMContent();
        });

        function convertIP() {
            const prefix = document.getElementById('prefix').value.trim();
            const ip = document.getElementById('ip').value.trim();

            if (!ip || !/^\d{1,3}(\.\d{1,3}){3}$/.test(ip)) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„ IP åœ°å€');
                return;
            }

            const ipPart = ip.replace(/\./g, '-');
            const domain = prefix ? `${prefix}-${ipPart}.${CONFIG.domain}` : `${ipPart}.${CONFIG.domain}`;
            document.getElementById('generated-domain').textContent = domain;
        }

        function copyDomain() {
            const domain = document.getElementById('generated-domain').textContent;
            if (domain && domain !== '-') {
                navigator.clipboard.writeText(domain);
                showToast('åŸŸåå·²å¤åˆ¶');
            }
        }

        async function loadCertInfo() {
            try {
                const resp = await fetch('certs/info.json');
                const info = await resp.json();

                document.getElementById('cert-domain').textContent = '*.' + CONFIG.domain;

                if (info.notAfter) {
                    const expiry = new Date(info.notAfter);
                    const now = new Date();
                    const daysLeft = Math.ceil((expiry - now) / (1000 * 60 * 60 * 24));

                    let expiryText = expiry.toLocaleDateString('zh-CN', {
                        year: 'numeric', month: 'long', day: 'numeric'
                    });

                    if (daysLeft <= 7) {
                        expiryText += ` <span class="badge danger">å³å°†è¿‡æœŸ</span>`;
                    } else if (daysLeft <= 30) {
                        expiryText += ` <span class="badge warning">${daysLeft} å¤©åè¿‡æœŸ</span>`;
                    } else {
                        expiryText += ` <span class="badge success">æœ‰æ•ˆ</span>`;
                    }

                    document.getElementById('cert-expiry').innerHTML = expiryText;
                }
            } catch (e) {
                document.getElementById('cert-domain').textContent = '*.' + CONFIG.domain;
                document.getElementById('cert-expiry').textContent = 'æ— æ³•åŠ è½½';
            }
        }

        async function loadPEMContent() {
            const keyFilename = `*.${CONFIG.domain}.key`;
            try {
                const [certResp, keyResp] = await Promise.all([
                    fetch('certs/fullchain.cer'),
                    fetch(`certs/${keyFilename}`)
                ]);

                if (certResp.ok) {
                    document.getElementById('cert-pem').value = await certResp.text();
                }
                if (keyResp && keyResp.ok) {
                    document.getElementById('key-pem').value = await keyResp.text();
                } else {
                    document.getElementById('key-pem').placeholder = 'æ— æ³•åŠ è½½ç§é’¥';
                }
            } catch (e) {
                console.error('åŠ è½½ PEM å†…å®¹å¤±è´¥:', e);
            }
        }

        function copyPEM(type) {
            const textarea = document.getElementById(type === 'cert' ? 'cert-pem' : 'key-pem');
            if (textarea.value) {
                navigator.clipboard.writeText(textarea.value);
                showToast(type === 'cert' ? 'è¯ä¹¦å·²å¤åˆ¶' : 'ç§é’¥å·²å¤åˆ¶');
            }
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 2000);
        }

        // å›è½¦è§¦å‘è½¬æ¢
        document.getElementById('ip')?.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') convertIP();
        });
    </script>
</body>

</html>